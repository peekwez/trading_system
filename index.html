<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Trading System by peekwez</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Trading System</h1>
      <h2 class="project-tagline">Python Scripts for Developing an Equity Trading System</h2>
      <a href="https://github.com/peekwez/trading_system" class="btn">View on GitHub</a>
      <a href="https://github.com/peekwez/trading_system/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/peekwez/trading_system/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="kapp-consult---trading-system-" class="anchor" href="#kapp-consult---trading-system-" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Kapp Consult - Trading System <a href="https://travis-ci.com/peekwez/trading_system"><img src="https://travis-ci.com/peekwez/trading_system.svg?token=BnDQr5dc9iRq4pSqsjvc&amp;branch=master" alt="Build Status"></a>
</h1>

<h2>
<a id="system-dependencies-ubuntu-1404-lts" class="anchor" href="#system-dependencies-ubuntu-1404-lts" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>System Dependencies (Ubuntu 14.04 LTS)</strong>
</h2>

<p>Install the following system dependencies</p>

<ul>
<li><a href="https://pip.pypa.io/en/stable/installing/">pip</a></li>
<li><a href="https://virtualenv.readthedocs.org/en/latest/installation.html">virtualenv</a></li>
<li><a href="http://virtualenvwrapper.readthedocs.org/en/latest/install.html">virtualenvwrapper</a></li>
<li><a href="https://nodejs.org/en/">Node.js</a></li>
<li><a href="https://docs.docker.com/engine/installation/">docker</a></li>
<li><a href="https://docs.docker.com/compose/install/">docker-compose</a></li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Installation</strong>
</h2>

<h3>
<a id="clone-repository" class="anchor" href="#clone-repository" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Clone Repository.</h3>

<pre><code>$ git clone git@github.com:&lt;peekwez&gt;/trading_system.git
$ cd trading_system
</code></pre>

<h3>
<a id="install-application-dependencies" class="anchor" href="#install-application-dependencies" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install Application Dependencies</h3>

<p>Copy and paste the lines below to install the following dependencies</p>

<pre><code>$ sudo apt-get install -y build-essential gfortran gcc libatlas-base-dev  curl git python-dev libpq-dev libssl-dev postgresql-client libxml2-dev libxsltl-dev libgraphviz-dev libopenblas-dev liblapack-dev
$ sudo apt-get build-dep python-matplotlib
$ pip install -r requirements.txt
$ npm install -g redis-commander
</code></pre>

<h2>
<a id="setup-instructions" class="anchor" href="#setup-instructions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Setup Instructions</strong>
</h2>

<h3>
<a id="initial-setup" class="anchor" href="#initial-setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Initial Setup</h3>

<pre><code>$ make setup
</code></pre>

<p>the command chains several commands to</p>

<ul>
<li><p>start a <code>postgres</code> and <code>redis</code> docker containers using <code>postgres:9.4.1</code> and <code>redis:2.8</code> images respectively. <code>docker-compose</code> is used to start the services. <code>postgres'</code> port <code>5432/tcp</code> is linked to port <code>5431</code> on the local machine, while <code>redis'</code> port <code>6379/tcp</code> is linked to port <code>6378</code> on the local machine. <code>redis</code> is started to serve as a broker for <code>celery</code></p></li>
<li><p>create a database called <code>securities_master</code> and a <code>Django</code> <strong>admin</strong> superuser for the application. The shell will prompt you to create the superuser login credentials</p></li>
<li><p>create a <code>logs</code> directory in <code>trading_system/src/</code> and log files for all the supervisor processes inside the <code>logs</code> directory</p></li>
</ul>

<h3>
<a id="supervisor-processes" class="anchor" href="#supervisor-processes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Supervisor Processes</h3>

<pre><code>$ make processes
$ make status  # (Check if processes are up and running)
</code></pre>

<p>the first command starts the following processes as a daemon</p>

<ul>
<li>
<code>celery worker</code> - a task queue for real-time processing</li>
<li>
<code>celery beat</code> -  a task scheduler</li>
<li>
<code>Django development server</code>  - the <strong>admin</strong> page is at <a href="http://localhost:8000/admin">http://localhost:8000/admin</a>
</li>
<li>
<code>celery flower</code> - web client for monitoring <code>celery-worker</code><a href="http://localhost:8001">http://localhost:8001</a>
</li>
<li>
<code>ipython notebook</code> - for python scripting; modules are imported using the <code>Django Shell-Plus</code> kernel <a href="http://localhost:8002">http://localhost:8002</a>
</li>
<li>
<code>redis-commander</code> web client for <code>redis</code> <a href="http://localhost:8003">http://localhost:8003</a>
</li>
</ul>

<h3>
<a id="populating-database" class="anchor" href="#populating-database" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Populating Database</h3>

<ul>
<li>
<p>execute the following <code>celery</code> tasks using <a href="http://localhost:8002"><code>ipython notebook</code></a> with the <code>Django Shell-Plus</code> kernel</p>

<div class="highlight highlight-source-python"><pre>tasks.add_symbols.delay() <span class="pl-c"># all symbols for S&amp;P/TSX and S&amp;P/TSXV Indices</span>
tasks.add_historical_data_all.delay() <span class="pl-c"># add historical data 10 year</span></pre></div>
</li>
</ul>

<h3>
<a id="updating-tickers-manually" class="anchor" href="#updating-tickers-manually" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Updating Tickers Manually</h3>

<ul>
<li><p>add the ticker(s) information to the <strong>Symbols table</strong> using the <a href="http://localhost:8000/admin">Admin Page</a></p></li>
<li>
<p>update the historical prices for the added tickers by executing the following commands inside a cell in the <a href="http://localhost:8002"><code>ipython notebook</code></a> using the <code>Django Shell-Plus</code> kernel</p>

<div class="highlight highlight-source-python"><pre>tasks.add_historical_data_ticker.delay(<span class="pl-v">tickers</span><span class="pl-k">=</span>[<span class="pl-s"><span class="pl-pds">'</span>BBD.B<span class="pl-pds">'</span></span>,<span class="pl-s"><span class="pl-pds">'</span>AME<span class="pl-pds">'</span></span>,<span class="pl-c1">...</span>])</pre></div>
</li>
</ul>

<h3>
<a id="daily-prices" class="anchor" href="#daily-prices" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Daily Prices</h3>

<ul>
<li>
<code>tasks.update_daily_quotes</code> task is executed every <strong>10 minutes</strong> between <strong>9am-6pm</strong> during the weekdays using <code>celery-beat</code> as the scheduler and the <code>celery-worker</code> as the task queue.</li>
</ul>

<h2>
<a id="after-system-restartreboot" class="anchor" href="#after-system-restartreboot" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>After System Restart/Reboot</strong>
</h2>

<p><code>cd</code> into application directory and execute the following commands</p>

<pre><code>$ make docker-services
$ make processes
</code></pre>

<h2>
<a id="miscellaneous" class="anchor" href="#miscellaneous" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><strong>Miscellaneous</strong>
</h2>

<h3>
<a id="sample-python-script" class="anchor" href="#sample-python-script" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sample Python Script</h3>

<p>The test script below uses the <a href="http://localhost:8002"><code>ipython notebook</code></a> launched to generate a simple moving average for companies whose latest <strong>close value</strong> is greater or equal to <strong>$0.5</strong> but less or equal to <strong>$2.5</strong>, and also with an average volume of <strong>100000</strong> shares since listed on the <strong>TSX</strong> exchange. The second part of the script performs a backward and forward test for a random (<strong>coin flip</strong>) trading strategy (<strong>short</strong> = 1, <strong>long</strong> = 0) using the tickers from the first part.</p>

<div class="highlight highlight-source-python"><pre>    <span class="pl-c"># -*- coding: utf-8 -*-</span>

<span class="pl-c"># turn matplotlib inline and save figs as pdfs or svg</span>
get_ipython().magic(<span class="pl-s"><span class="pl-k">u</span><span class="pl-pds">"</span>matplotlib inline<span class="pl-pds">"</span></span>)
get_ipython().magic(<span class="pl-s"><span class="pl-k">u</span><span class="pl-pds">"</span>config InlineBackend.figure_format = 'svg'<span class="pl-pds">"</span></span>)

<span class="pl-c"># get latest date in database</span>
latest_price <span class="pl-k">=</span> DailyPrice.objects.latest(<span class="pl-s"><span class="pl-pds">'</span>price_date<span class="pl-pds">'</span></span>)
latest_date  <span class="pl-k">=</span> latest_price.price_date.strftime(<span class="pl-s"><span class="pl-pds">'</span>%Y-%m-<span class="pl-c1">%d</span><span class="pl-pds">'</span></span>)

<span class="pl-c"># define constraints</span>
lower <span class="pl-k">=</span> <span class="pl-c1">0.5</span>
upper <span class="pl-k">=</span> <span class="pl-c1">2.5</span>
volume <span class="pl-k">=</span> <span class="pl-c1">100000</span>
exchange <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>TSX<span class="pl-pds">'</span></span>

<span class="pl-c"># fetch tickers with daily bars</span>
tickers <span class="pl-k">=</span> DailyPrice.objects.annotate(
    <span class="pl-v">average_volume</span><span class="pl-k">=</span>Avg(<span class="pl-s"><span class="pl-pds">'</span>volume<span class="pl-pds">'</span></span>)
).filter(
    <span class="pl-v">close_price__lte</span><span class="pl-k">=</span>upper,
    <span class="pl-v">close_price__gte</span><span class="pl-k">=</span>lower,
    <span class="pl-v">average_volume__gte</span><span class="pl-k">=</span>volume,
    <span class="pl-v">symbol__exchange__abbrev</span><span class="pl-k">=</span>exchange,
    <span class="pl-v">price_date</span><span class="pl-k">=</span>latest_date
).order_by(
    <span class="pl-s"><span class="pl-pds">'</span>close_price<span class="pl-pds">'</span></span>
).values_list(
    <span class="pl-s"><span class="pl-pds">'</span>symbol__ticker<span class="pl-pds">'</span></span>,
    <span class="pl-v">flat</span><span class="pl-k">=</span><span class="pl-c1">True</span>
)


<span class="pl-c"># Plot Close Price and Moving Averages for Specific Tickers</span>

<span class="pl-c"># plot constraints</span>
start_date <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>2015-01-01<span class="pl-pds">'</span></span>
end_date <span class="pl-k">=</span> latest_date
ma_type <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>exponential<span class="pl-pds">'</span></span> <span class="pl-c"># options='simple' or 'exponential'</span>

<span class="pl-c"># get number of plots</span>
end <span class="pl-k">=</span> <span class="pl-c1">min</span>(<span class="pl-c1">len</span>(tickers),<span class="pl-c1">20</span>)

<span class="pl-c"># initialize plot class and plot tickers</span>
f <span class="pl-k">=</span> plots.PlotSymbol(tickers[:end])
f.plot(<span class="pl-v">ma_type</span><span class="pl-k">=</span>ma_type, <span class="pl-v">start_date</span><span class="pl-k">=</span>start_date, <span class="pl-v">end_date</span><span class="pl-k">=</span>end_date)


<span class="pl-c"># Trading Strategy Simulations</span>

<span class="pl-c"># initialize simulations for tickers</span>
g <span class="pl-k">=</span> []

<span class="pl-c"># get number of plots</span>
end <span class="pl-k">=</span> <span class="pl-c1">min</span>(<span class="pl-c1">len</span>(tickers),<span class="pl-c1">3</span>)

<span class="pl-c"># initialize strategy class</span>
strategy <span class="pl-k">=</span> strategies.RandomStrategy()

<span class="pl-c"># start simulation</span>
<span class="pl-k">for</span> k,ticker <span class="pl-k">in</span> <span class="pl-c1">enumerate</span>(tickers[:end]):

    <span class="pl-c"># initialize the basic random generator</span>
    seed()

    <span class="pl-c"># initialize simulation class and test strategy</span>
    g.append(simulations.MonteCarlo(strategy,ticker))
    g[k].run_strategy()</pre></div>

<h3>
<a id="makefile-help" class="anchor" href="#makefile-help" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Makefile Help</h3>

<p>Use the command below to see the options available for Makefile</p>

<pre><code>$ make help
</code></pre>

<h3>
<a id="file-structure" class="anchor" href="#file-structure" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>File Structure</h3>

<pre><code>├── docker-compose.yml
├── fabfile.py
├── Makefile
├── Makefile.in
├── monaco.ttf
├── nginx.conf
├── README.md
├── requirements.txt
├── setup.cfg
├── src
│   ├── data
│   │   ├── admin.py
│   │   ├── assets
│   │   │   ├── __init__.py
│   │   │   ├── other.csv
│   │   │   ├── sec.csv
│   │   │   ├── tsx.csv
│   │   │   └── tsxv.csv
│   │   ├── constants.py
│   │   ├── __init__.py
│   │   ├── migrations
│   │   │   └── __init__.py
│   │   ├── misc.py
│   │   ├── models.py
│   │   ├── plots.py
│   │   ├── tasks.py
│   │   ├── tests.py
│   │   ├── utils.py
│   │   └── views.py
│   ├── db
│   │   ├── celery.py
│   │   ├── __init__.py
│   │   ├── settings.py
│   │   ├── urls.py
│   │   └── wsgi.py
│   ├── manage.py
│   └── systems
│       ├── bitops.py
│       ├── __init__.py
│       ├── simulations.py
│       ├── strategies.py
│       └── tests
│           ├── __init__.py
│           └── test_bitops.py
└── supervisord.conf
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/peekwez/trading_system">Trading System</a> is maintained by <a href="https://github.com/peekwez">peekwez</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
